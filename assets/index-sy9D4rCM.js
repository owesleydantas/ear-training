(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();let m=null;function v(){return m||(m=new AudioContext),m.state==="suspended"&&m.resume(),m}const q=["major","minor","augmented","diminished"],x={major:[0,4,7],minor:[0,3,7],augmented:[0,4,8],diminished:[0,3,6]},T=[{name:"C",freq:261.63},{name:"D",freq:293.66},{name:"E",freq:329.63},{name:"F",freq:349.23},{name:"G",freq:392},{name:"A",freq:440},{name:"B",freq:493.88}];function L(r,s){return r*Math.pow(2,s/12)}const A=2;function w(r,s){const i=v(),o=i.currentTime;x[r].forEach(n=>{const a=L(s,n),d=i.createOscillator(),l=i.createOscillator(),u=i.createGain(),p=i.createBiquadFilter();d.type="triangle",l.type="sine",d.frequency.value=a,l.frequency.value=a*1.003;const M=Math.min(1,a/440);p.frequency.setValueAtTime(1200+M*3e3,o),u.gain.setValueAtTime(1e-4,o),u.gain.exponentialRampToValueAtTime(.12,o+.015),u.gain.exponentialRampToValueAtTime(1e-4,o+A*.9),d.connect(p),l.connect(p),p.connect(u),u.connect(i.destination),d.start(o),l.start(o),d.stop(o+A),l.stop(o+A)})}const e={state:"idle",chordType:null,root:null,remainingRepeats:0,hits:0,misses:0},h=document.getElementById("play-chord"),y=document.getElementById("repeat-chord"),c=document.getElementById("feedback"),I=document.getElementById("hits"),B=document.getElementById("misses"),O=document.getElementById("vary-root"),b=document.querySelectorAll("#answer button");function E(r){b.forEach(s=>s.disabled=r)}function R(r){switch(r){case"idle":h.disabled=!1,y.disabled=!0,E(!0);break;case"playing":h.disabled=!0,y.disabled=!1,E(!1);break;case"answered":h.disabled=!1,y.disabled=!0,E(!0);break}}function g(){c.classList.remove("correct","wrong")}const C={major:"Maior (M)",minor:"Menor (m)",augmented:"Aumentado (+)",diminished:"Diminuto (°)"};function F(){g(),c.textContent="Qual é o tipo de acorde?"}function D(r){g(),c.classList.add("correct"),c.textContent=`Correto! Acorde: ${C[r]}`}function N(r){g(),c.classList.add("wrong"),c.textContent=`Incorreto. Acorde: ${C[r]}`}function f(r){g(),c.textContent=r}function P(r,s){I.textContent=String(r),B.textContent=String(s)}document.addEventListener("DOMContentLoaded",()=>{function o(t){let n=t;for(;n<87.31;)n*=2;for(;n>440;)n/=2;return n}h.addEventListener("click",()=>{if(e.state==="playing"){f("Responda antes de ouvir outro acorde.");return}const t=q[Math.floor(Math.random()*q.length)];e.chordType=t;const n=O.checked?T[Math.floor(Math.random()*T.length)]:T[0];e.root={...n,freq:o(n.freq)},e.state="playing",R("playing"),e.remainingRepeats=2,F(),!(!e.chordType||!e.root)&&w(e.chordType,e.root.freq)}),b.forEach(t=>{t.addEventListener("click",()=>{if(e.state!=="playing"||!e.chordType){f("Clique primeiro em 'Ouvir acorde'.");return}t.dataset.answer===e.chordType?(e.hits++,D(e.chordType)):(e.misses++,N(e.chordType)),P(e.hits,e.misses),e.state="answered",R("answered"),e.chordType=null})}),y.addEventListener("click",()=>{if(e.state!=="playing"||!e.chordType||!e.root){f("Não há acorde para repetir.");return}if(e.remainingRepeats<=0){f("Limite de repetições atingigo.");return}e.remainingRepeats--,w(e.chordType,e.root.freq),f(`Acorde repetido (${e.remainingRepeats} restantes.)`)})});
